<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Hive Batch Upvote</title>

<script src="https://cdn.jsdelivr.net/npm/@hiveio/hive-js/dist/hive.min.js"></script>
<script>
hive.api.setOptions({ url: 'https://api.hive.blog' });
hive.config.set('address_prefix','STM');
hive.config.set('chain_id','beeab0de00000000000000000000000000000000000000000000000000000000');
</script>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 16px;
  font-family: system-ui, sans-serif;
  background: #f4f4f4;
}

.container {
  max-width: 480px;
  margin: auto;
  background: #fff;
  padding: 18px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,.15);
}

h2 { text-align: center; margin-bottom: 12px; }

.tools-bar {
  display: flex;
  gap: 10px;
  margin-bottom: 14px;
}

.tool-btn {
  flex: 1;
  padding: 12px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

.export { background: #e3f2fd; color: #1565c0; }
.import { background: #e8f5e9; color: #2e7d32; }

label {
  font-size: 14px;
  font-weight: 600;
  margin-top: 10px;
  display: block;
}

input[type=text], input[type=password] {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

.add-btn {
  margin-top: 14px;
  width: 100%;
  padding: 14px;
  font-size: 16px;
  font-weight: 700;
  border-radius: 10px;
  border: none;
  background: #4caf50;
  color: #fff;
  cursor: pointer;
}

.account {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #f7f7f7;
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 8px;
}

.account input { transform: scale(1.2); }

.account-name {
  flex: 1;
  font-size: 15px;
  font-weight: 600;
  word-break: break-all;
}

.status {
  font-size: 12px;
  color: #777;
}

.vote-btn {
  margin-top: 16px;
  width: 100%;
  padding: 16px;
  font-size: 17px;
  font-weight: 800;
  border-radius: 12px;
  border: none;
  background: #ff5722;
  color: #fff;
  cursor: pointer;
}

.progress-wrap {
  margin-top: 14px;
}

.progress {
  width: 100%;
  height: 10px;
  background: #ddd;
  border-radius: 6px;
  overflow: hidden;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: #4caf50;
  transition: width .3s;
}

.note {
  font-size: 12px;
  text-align: center;
  margin-top: 8px;
  color: #666;
}
</style>
</head>

<body>

<div class="container">
<h2>Hive Batch Upvote</h2>

<div class="tools-bar">
<button class="tool-btn export" onclick="exportAccounts()">Export</button>
<button class="tool-btn import" onclick="document.getElementById('importFile').click()">Import</button>
<input type="file" id="importFile" hidden onchange="importAccounts(event)">
</div>

<label>Username</label>
<input id="username" type="text">

<label>Posting Private Key</label>
<input id="postingKey" type="password">

<button class="add-btn" onclick="addAccount()">Tambah Akun</button>

<div id="accountList"></div>

<label>Link Post Hive</label>
<input id="postLink" type="text">

<button class="vote-btn" onclick="voteAll()">Vote Semua Akun</button>

<div class="progress-wrap">
<div class="progress">
<div class="progress-bar" id="progressBar"></div>
</div>
<div id="globalStatus" class="note"></div>
</div>

<div class="note">Delay antar akun: Â±3 detik</div>
</div>

<script>

let accounts = JSON.parse(localStorage.getItem('hive_accounts') || '[]');
const DELAY = 3000;

function save(){
  localStorage.setItem('hive_accounts', JSON.stringify(accounts));
}

function render(){
  accountList.innerHTML = '';

  accounts.forEach((a,i)=>{
    accountList.innerHTML += `
      <div class="account">
        <input type="checkbox" checked data-i="${i}">
        <div class="account-name">@${a.username}</div>
        <div class="status" id="st-${i}">ready</div>
      </div>`;
  });
}

function addAccount(){

  const user = username.value.trim();
  const key = postingKey.value.trim();

  if(!user || !key){
    alert("Isi username & key");
    return;
  }

  accounts.push({username:user, key:key});
  save();
  render();

  username.value='';
  postingKey.value='';
}

function exportAccounts(){
  const blob = new Blob([JSON.stringify(accounts)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'hive-accounts.json';
  a.click();
}

function importAccounts(e){
  const reader = new FileReader();
  reader.onload = ()=>{
    try{
      accounts = JSON.parse(reader.result);
      save();
      render();
    }catch{
      alert("File tidak valid");
    }
  };
  reader.readAsText(e.target.files[0]);
}

async function voteAll(){

  const link = postLink.value.trim();
  if(!link){
    alert("Link kosong");
    return;
  }

  /* parsing stabil */
  const parts = link.split('/');
  if(parts.length < 6){
    alert("Link tidak valid");
    return;
  }

  const author = parts[4].replace('@','');
  const permlink = parts[5];

  const selected = [...document.querySelectorAll('.account input:checked')];

  if(selected.length === 0){
    alert("Tidak ada akun dipilih");
    return;
  }

  let done = 0;

  globalStatus.textContent = "broadcasting...";
  progressBar.style.width = "0%";

  for(const cb of selected){

    const i = cb.dataset.i;
    const acc = accounts[i];

    document.getElementById(`st-${i}`).textContent = "broadcasting";

    await new Promise(res=>{
      hive.broadcast.vote(
        acc.key,
        acc.username,
        author,
        permlink,
        10000,
        function(err,result){

          console.log(err,result);

          document.getElementById(`st-${i}`).textContent =
            err ? "failed" : "success";

          done++;

          progressBar.style.width =
            Math.round(done/selected.length*100)+"%";

          setTimeout(res, DELAY);
        }
      );
    });

  }

  globalStatus.textContent = "done";
}

render();

</script>

</body>
</html>
